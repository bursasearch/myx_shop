<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>Shopee äº§å“ç®¡ç† - APIç‰ˆ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Segoe UI', Arial, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
    .container { max-width: 1400px; margin: 0 auto; }
    
    /* APIçŠ¶æ€æŒ‡ç¤ºå™¨ */
    .api-status {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 10px 15px;
      border-radius: 25px;
      color: white;
      font-size: 12px;
      font-weight: 500;
      z-index: 1000;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s;
    }
    .api-status.connected {
      background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
    }
    .api-status.disconnected {
      background: linear-gradient(135deg, #FF5252 0%, #D32F2F 100%);
    }
    .api-status.connecting {
      background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%);
    }
    
    /* APIé…ç½®é¢æ¿ */
    .api-config {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 15px;
      border-left: 4px solid #667eea;
      display: none;
    }
    .api-config.show {
      display: block;
    }
    .api-config label {
      font-size: 12px;
      color: #666;
      display: block;
      margin-bottom: 5px;
    }
    .api-config input {
      width: 100%;
      padding: 8px 12px;
      border: 2px solid #e0e0e0;
      border-radius: 6px;
      font-size: 14px;
      margin-bottom: 10px;
    }
    .api-config input:focus {
      border-color: #667eea;
      outline: none;
    }
    
    /* å¤´éƒ¨ */
    .header { background: white; padding: 25px; border-radius: 15px; margin-bottom: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
    .header h1 { color: #333; margin-bottom: 15px; font-size: 28px; }
    .header h1 i { color: #ff6b6b; margin-right: 10px; }
    
    /* ç»Ÿè®¡å¡ç‰‡ */
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; }
    .stat-card { background: #f8f9fa; padding: 20px; border-radius: 10px; border-left: 5px solid #4CAF50; }
    .stat-card h3 { color: #666; font-size: 14px; margin-bottom: 10px; }
    .stat-card .number { font-size: 32px; font-weight: bold; color: #333; }
    
    /* æŒ‰é’® */
    .btn { padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500; transition: all 0.3s; display: inline-flex; align-items: center; gap: 8px; }
    .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
    .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
    .btn-success { background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%); color: white; }
    .btn-warning { background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%); color: white; }
    .btn-danger { background: linear-gradient(135deg, #FF5252 0%, #D32F2F 100%); color: white; }
    .btn-info { background: linear-gradient(135deg, #2196F3 0%, #0D47A1 100%); color: white; }
    
    /* æ·»åŠ äº§å“è¡¨å• */
    .add-form { background: white; padding: 25px; border-radius: 15px; margin-bottom: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
    .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
    .form-group label { display: block; margin-bottom: 8px; color: #555; font-weight: 500; }
    .form-group input, .form-group select { width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; transition: border 0.3s; }
    .form-group input:focus, .form-group select:focus { border-color: #667eea; outline: none; }
    
    /* äº§å“å¡ç‰‡ç½‘æ ¼ */
    .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 25px; }
    .product-card { background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 5px 20px rgba(0,0,0,0.1); transition: all 0.3s; }
    .product-card:hover { transform: translateY(-5px); box-shadow: 0 15px 30px rgba(0,0,0,0.2); }
    .product-image { width: 100%; height: 200px; object-fit: cover; }
    .product-info { padding: 20px; }
    .product-name { font-size: 18px; font-weight: 600; color: #333; margin-bottom: 10px; }
    .product-price { font-size: 24px; font-weight: bold; color: #4CAF50; margin-bottom: 10px; }
    .product-details { display: flex; justify-content: space-between; color: #666; font-size: 14px; margin-bottom: 15px; }
    .product-actions { display: flex; gap: 10px; flex-wrap: wrap; }
    
    /* æœç´¢æ¡† */
    .search-box { position: relative; margin-bottom: 25px; }
    .search-box input { width: 100%; padding: 15px 20px 15px 50px; border: 2px solid #e0e0e0; border-radius: 50px; font-size: 16px; background: white url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='11' cy='11' r='8'%3E%3C/circle%3E%3Cline x1='21' y1='21' x2='16.65' y2='16.65'%3E%3C/line%3E%3C/svg%3E") no-repeat 20px center; }
    .search-box input:focus { border-color: #667eea; outline: none; }
    
    /* æ¶ˆæ¯æç¤º */
    .message { position: fixed; top: 20px; right: 20px; padding: 15px 25px; border-radius: 10px; color: white; font-weight: 500; z-index: 1000; animation: slideIn 0.3s ease-out; }
    .message.success { background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%); }
    .message.error { background: linear-gradient(135deg, #FF5252 0%, #D32F2F 100%); }
    .message.warning { background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%); }
    @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    
    /* å“åº”å¼ */
    @media (max-width: 768px) {
      .form-grid { grid-template-columns: 1fr; }
      .products-grid { grid-template-columns: 1fr; }
      .stats-grid { grid-template-columns: 1fr; }
      .api-status { top: 10px; right: 10px; }
    }
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
  <!-- APIçŠ¶æ€æŒ‡ç¤ºå™¨ -->
  <div id="apiStatus" class="api-status connecting">
    <i class="fas fa-circle-notch fa-spin"></i>
    <span>è¿æ¥APIä¸­...</span>
  </div>

  <!-- APIé…ç½®é¢æ¿ -->
  <div id="apiConfig" class="api-config">
    <h3 style="margin-bottom: 15px; color: #333;"><i class="fas fa-cog"></i> API é…ç½®</h3>
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
      <div>
        <label>API åŸºç¡€URL</label>
        <input type="text" id="apiBaseUrl" value="http://localhost:3000/api" placeholder="http://localhost:3000/api">
      </div>
      <div>
        <label>APIå¯†é’¥ (å¯é€‰)</label>
        <input type="text" id="apiKey" placeholder="è¾“å…¥APIå¯†é’¥">
      </div>
    </div>
    <button class="btn btn-primary" onclick="saveApiConfig()" style="margin-top: 10px; padding: 8px 16px;">
      <i class="fas fa-save"></i> ä¿å­˜é…ç½®
    </button>
  </div>

  <div class="container">
    <!-- å¤´éƒ¨ -->
    <div class="header">
      <div style="display: flex; justify-content: space-between; align-items: flex-start;">
        <div>
          <h1><i class="fas fa-store"></i> Shopee äº§å“ç®¡ç†ç³»ç»Ÿ - APIç‰ˆ</h1>
          <p style="color: #666; margin-top: 5px;">è¿æ¥åˆ°æœ¬åœ°æˆ–è¿œç¨‹APIæœåŠ¡å™¨</p>
        </div>
        <button class="btn btn-info" onclick="toggleApiConfig()">
          <i class="fas fa-cog"></i> APIè®¾ç½®
        </button>
      </div>
      
      <div class="stats-grid">
        <div class="stat-card">
          <h3>äº§å“æ€»æ•°</h3>
          <div class="number" id="totalCount">0</div>
        </div>
        <div class="stat-card">
          <h3>æ€»åº“å­˜</h3>
          <div class="number" id="totalStock">0</div>
        </div>
        <div class="stat-card">
          <h3>APIçŠ¶æ€</h3>
          <div class="number" id="apiStatusText">æ£€æŸ¥ä¸­</div>
        </div>
      </div>
      
      <div style="display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap;">
        <button class="btn btn-primary" onclick="fetchProducts()">
          <i class="fas fa-sync-alt"></i> ä»APIåŠ è½½
        </button>
        <button class="btn btn-success" onclick="syncToApi()">
          <i class="fas fa-cloud-upload-alt"></i> åŒæ­¥åˆ°API
        </button>
        <button class="btn btn-warning" onclick="exportData()">
          <i class="fas fa-download"></i> å¯¼å‡ºJSON
        </button>
        <button class="btn btn-danger" onclick="deleteAllProducts()">
          <i class="fas fa-trash"></i> æ¸…ç©ºæœ¬åœ°
        </button>
      </div>
    </div>

    <!-- æœç´¢æ¡† -->
    <div class="search-box">
      <input type="text" id="searchInput" placeholder="ğŸ” æœç´¢äº§å“åç§°ã€åˆ†ç±»..." oninput="filterProducts()">
    </div>

    <!-- æ·»åŠ äº§å“è¡¨å• -->
    <div class="add-form">
      <h2 style="margin-bottom: 20px; color: #333;"><i class="fas fa-plus-circle"></i> æ·»åŠ æ–°äº§å“</h2>
      <form id="addForm">
        <div class="form-grid">
          <div class="form-group">
            <label><i class="fas fa-tag"></i> äº§å“åç§° *</label>
            <input type="text" id="productName" placeholder="è¾“å…¥äº§å“åç§°" required>
          </div>
          <div class="form-group">
            <label><i class="fas fa-money-bill-wave"></i> ä»·æ ¼ (RM) *</label>
            <input type="number" step="0.01" id="productPrice" placeholder="0.00" required>
          </div>
          <div class="form-group">
            <label><i class="fas fa-boxes"></i> åº“å­˜æ•°é‡ *</label>
            <input type="number" id="productStock" placeholder="0" required>
          </div>
          <div class="form-group">
            <label><i class="fas fa-folder"></i> åˆ†ç±» *</label>
            <select id="productCategory" required>
              <option value="">é€‰æ‹©åˆ†ç±»</option>
              <option value="health">ä¿å¥å…»ç”Ÿ</option>
              <option value="home">å®¶å±…ç”Ÿæ´»</option>
              <option value="electronic">ç”µå­äº§å“</option>
              <option value="book">å›¾ä¹¦æ–‡å…·</option>
            </select>
          </div>
          <div class="form-group">
            <label><i class="fas fa-image"></i> å›¾ç‰‡æ–‡ä»¶å</label>
            <input type="text" id="productImage" placeholder="ä¾‹å¦‚: sh-61_1111.png">
          </div>
          <div class="form-group">
            <label><i class="fas fa-link"></i> Shopeeé“¾æ¥</label>
            <input type="text" id="productLink" placeholder="https://shopee.com.my/...">
          </div>
        </div>
        <div style="margin-top: 25px; display: flex; gap: 15px;">
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-check-circle"></i> æ·»åŠ äº§å“
          </button>
          <button type="button" class="btn btn-warning" onclick="addToApi()">
            <i class="fas fa-cloud-upload"></i> ç›´æ¥æ·»åŠ åˆ°API
          </button>
          <button type="button" class="btn" onclick="clearForm()" style="background: #6c757d; color: white;">
            <i class="fas fa-trash-alt"></i> æ¸…ç©ºè¡¨å•
          </button>
        </div>
      </form>
    </div>

    <!-- äº§å“å¡ç‰‡ç½‘æ ¼ -->
    <div id="productsContainer">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2 style="color: white;" id="productsTitle">äº§å“åˆ—è¡¨ (0)</h2>
        <div style="color: white; font-size: 14px;">
          æœ¬åœ°æ•°æ® | 
          <button class="btn btn-success" onclick="syncAllToApi()" style="padding: 5px 10px; font-size: 12px;">
            <i class="fas fa-cloud-upload-alt"></i> åŒæ­¥å…¨éƒ¨åˆ°API
          </button>
        </div>
      </div>
      <div class="products-grid" id="productsGrid"></div>
    </div>
  </div>

  <!-- æ¶ˆæ¯æç¤ºå®¹å™¨ -->
  <div id="messageContainer"></div>

  <script>
    // APIé…ç½®
    let apiConfig = {
      baseUrl: 'http://localhost:3000/api',
      apiKey: '',
      connected: false
    };
    
    let products = [];
    let currentId = 1;

    // åˆå§‹åŒ–APIé…ç½®
    function initApiConfig() {
      const savedConfig = localStorage.getItem('shopeeApiConfig');
      if (savedConfig) {
        apiConfig = JSON.parse(savedConfig);
        document.getElementById('apiBaseUrl').value = apiConfig.baseUrl;
        document.getElementById('apiKey').value = apiConfig.apiKey;
      }
      checkApiConnection();
    }

    // åˆ‡æ¢APIé…ç½®é¢æ¿
    function toggleApiConfig() {
      const configPanel = document.getElementById('apiConfig');
      configPanel.classList.toggle('show');
    }

    // ä¿å­˜APIé…ç½®
    function saveApiConfig() {
      apiConfig.baseUrl = document.getElementById('apiBaseUrl').value.trim();
      apiConfig.apiKey = document.getElementById('apiKey').value.trim();
      
      localStorage.setItem('shopeeApiConfig', JSON.stringify(apiConfig));
      showMessage('âœ… APIé…ç½®å·²ä¿å­˜', 'success');
      checkApiConnection();
    }

    // æ£€æŸ¥APIè¿æ¥
    async function checkApiConnection() {
      updateApiStatus('connecting', 'è¿æ¥APIä¸­...');
      
      try {
        // å°è¯•è¿æ¥å¥åº·æ£€æŸ¥ç«¯ç‚¹
        const response = await fetch(`${apiConfig.baseUrl}/health`, {
          method: 'GET',
          headers: getApiHeaders(),
          timeout: 5000
        });
        
        if (response.ok) {
          apiConfig.connected = true;
          updateApiStatus('connected', 'APIå·²è¿æ¥');
          showMessage('âœ… APIæœåŠ¡å™¨è¿æ¥æˆåŠŸ', 'success');
        } else {
          apiConfig.connected = false;
          updateApiStatus('disconnected', 'APIè¿æ¥å¤±è´¥');
          showMessage('âš ï¸ APIæœåŠ¡å™¨ä¸å¯ç”¨ï¼Œä½¿ç”¨æœ¬åœ°æ¨¡å¼', 'warning');
        }
      } catch (error) {
        apiConfig.connected = false;
        updateApiStatus('disconnected', 'APIæ— å“åº”');
        showMessage('âš ï¸ APIæœåŠ¡å™¨è¿æ¥å¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°æ¨¡å¼', 'warning');
      }
    }

    // æ›´æ–°APIçŠ¶æ€æ˜¾ç¤º
    function updateApiStatus(status, text) {
      const statusEl = document.getElementById('apiStatus');
      const textEl = document.getElementById('apiStatusText');
      
      statusEl.className = `api-status ${status}`;
      statusEl.innerHTML = `<i class="fas fa-${getStatusIcon(status)}"></i> <span>${text}</span>`;
      if (textEl) textEl.textContent = text;
    }

    function getStatusIcon(status) {
      switch(status) {
        case 'connected': return 'check-circle';
        case 'disconnected': return 'times-circle';
        case 'connecting': return 'circle-notch fa-spin';
        default: return 'question-circle';
      }
    }

    // è·å–APIè¯·æ±‚å¤´
    function getApiHeaders() {
      const headers = {
        'Content-Type': 'application/json'
      };
      
      if (apiConfig.apiKey) {
        headers['Authorization'] = `Bearer ${apiConfig.apiKey}`;
      }
      
      return headers;
    }

    // ä»APIè·å–äº§å“
    async function fetchProducts() {
      if (!apiConfig.connected) {
        showMessage('âŒ APIæœªè¿æ¥ï¼Œè¯·æ£€æŸ¥é…ç½®', 'error');
        return;
      }
      
      try {
        showMessage('æ­£åœ¨ä»APIåŠ è½½æ•°æ®...', 'success');
        const response = await fetch(`${apiConfig.baseUrl}/products`, {
          method: 'GET',
          headers: getApiHeaders()
        });
        
        if (!response.ok) throw new Error(`HTTPé”™è¯¯: ${response.status}`);
        
        const data = await response.json();
        products = data.products || data;
        currentId = Math.max(...products.map(p => p.id), 0) + 1;
        
        updateDisplay();
        showMessage(`âœ… ä»APIåŠ è½½æˆåŠŸï¼å…± ${products.length} ä¸ªäº§å“`, 'success');
      } catch (error) {
        console.error('APIåŠ è½½å¤±è´¥:', error);
        showMessage(`âŒ APIåŠ è½½å¤±è´¥: ${error.message}`, 'error');
      }
    }

    // æ·»åŠ äº§å“åˆ°API
    async function addToApi() {
      if (!apiConfig.connected) {
        showMessage('âŒ APIæœªè¿æ¥ï¼Œè¯·å…ˆæ£€æŸ¥è¿æ¥', 'error');
        return;
      }
      
      const product = {
        name: document.getElementById('productName').value.trim(),
        price: parseFloat(document.getElementById('productPrice').value),
        stock: parseInt(document.getElementById('productStock').value),
        image: document.getElementById('productImage').value.trim() || `sh-${currentId}.jpg`,
        link: document.getElementById('productLink').value.trim(),
        category: document.getElementById('productCategory').value,
        status: "active",
        sales: 0
      };
      
      if (!product.name || !product.category) {
        showMessage('âŒ è¯·å¡«å†™äº§å“åç§°å’Œåˆ†ç±»', 'error');
        return;
      }
      
      try {
        const response = await fetch(`${apiConfig.baseUrl}/products`, {
          method: 'POST',
          headers: getApiHeaders(),
          body: JSON.stringify(product)
        });
        
        if (!response.ok) throw new Error(`HTTPé”™è¯¯: ${response.status}`);
        
        const newProduct = await response.json();
        products.push(newProduct);
        updateDisplay();
        document.getElementById('addForm').reset();
        showMessage(`âœ… äº§å“å·²æˆåŠŸæ·»åŠ åˆ°APIï¼ID: ${newProduct.id}`, 'success');
      } catch (error) {
        showMessage(`âŒ æ·»åŠ åˆ°APIå¤±è´¥: ${error.message}`, 'error');
      }
    }

    // åŒæ­¥å•ä¸ªäº§å“åˆ°API
    async function syncProductToApi(product) {
      try {
        // æ£€æŸ¥äº§å“æ˜¯å¦å·²å­˜åœ¨
        const response = await fetch(`${apiConfig.baseUrl}/products/${product.id}`, {
          method: 'GET',
          headers: getApiHeaders()
        });
        
        let apiResponse;
        if (response.status === 404) {
          // äº§å“ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°è®°å½•
          apiResponse = await fetch(`${apiConfig.baseUrl}/products`, {
            method: 'POST',
            headers: getApiHeaders(),
            body: JSON.stringify(product)
          });
        } else {
          // äº§å“å­˜åœ¨ï¼Œæ›´æ–°è®°å½•
          apiResponse = await fetch(`${apiConfig.baseUrl}/products/${product.id}`, {
            method: 'PUT',
            headers: getApiHeaders(),
            body: JSON.stringify(product)
          });
        }
        
        if (!apiResponse.ok) throw new Error(`HTTPé”™è¯¯: ${apiResponse.status}`);
        
        return await apiResponse.json();
      } catch (error) {
        throw error;
      }
    }

    // åŒæ­¥æ‰€æœ‰äº§å“åˆ°API
    async function syncAllToApi() {
      if (!apiConfig.connected) {
        showMessage('âŒ APIæœªè¿æ¥', 'error');
        return;
      }
      
      if (products.length === 0) {
        showMessage('âŒ æ²¡æœ‰äº§å“å¯åŒæ­¥', 'error');
        return;
      }
      
      showMessage('æ­£åœ¨åŒæ­¥äº§å“åˆ°API...', 'success');
      
      let successCount = 0;
      let failCount = 0;
      
      for (const product of products) {
        try {
          await syncProductToApi(product);
          successCount++;
        } catch (error) {
          console.error(`åŒæ­¥äº§å“ ${product.id} å¤±è´¥:`, error);
          failCount++;
        }
      }
      
      showMessage(`âœ… åŒæ­¥å®Œæˆï¼æˆåŠŸ: ${successCount}, å¤±è´¥: ${failCount}`, 
                  failCount > 0 ? 'warning' : 'success');
    }

    // åŒæ­¥åˆ°APIï¼ˆæ‰¹é‡ï¼‰
    async function syncToApi() {
      if (!apiConfig.connected) {
        showMessage('âŒ APIæœªè¿æ¥', 'error');
        return;
      }
      
      try {
        const response = await fetch(`${apiConfig.baseUrl}/products/batch`, {
          method: 'POST',
          headers: getApiHeaders(),
          body: JSON.stringify({ products })
        });
        
        if (!response.ok) throw new Error(`HTTPé”™è¯¯: ${response.status}`);
        
        const result = await response.json();
        showMessage(`âœ… æ‰¹é‡åŒæ­¥æˆåŠŸï¼æ›´æ–°äº† ${result.updated || products.length} ä¸ªäº§å“`, 'success');
      } catch (error) {
        // å¦‚æœæ‰¹é‡æ¥å£ä¸å­˜åœ¨ï¼Œå°è¯•é€ä¸ªåŒæ­¥
        if (error.message.includes('404') || error.message.includes('batch')) {
          await syncAllToApi();
        } else {
          showMessage(`âŒ åŒæ­¥å¤±è´¥: ${error.message}`, 'error');
        }
      }
    }

    // åˆ é™¤æ‰€æœ‰æœ¬åœ°äº§å“
    function deleteAllProducts() {
      if (!confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æœ¬åœ°äº§å“æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼')) return;
      
      products = [];
      updateDisplay();
      showMessage('âœ… æ‰€æœ‰æœ¬åœ°äº§å“æ•°æ®å·²æ¸…ç©º', 'success');
    }

    // å…¶ä»–å‡½æ•°ä¿æŒä¸å˜ï¼ˆupdateDisplay, renderProducts, getSampleDataç­‰ï¼‰
    function updateDisplay() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      const filtered = products.filter(p => 
        p.name.toLowerCase().includes(searchTerm) || 
        (p.category && p.category.toLowerCase().includes(searchTerm))
      );
      
      document.getElementById('totalCount').textContent = products.length;
      document.getElementById('totalStock').textContent = products.reduce((sum, p) => sum + (p.stock || 0), 0);
      document.getElementById('productsTitle').textContent = `äº§å“åˆ—è¡¨ (${filtered.length})`;
      
      renderProducts(filtered);
    }

    function renderProducts(productsToShow) {
      const grid = document.getElementById('productsGrid');
      
      if (productsToShow.length === 0) {
        grid.innerHTML = `
          <div style="grid-column: 1 / -1; text-align: center; padding: 60px; background: white; border-radius: 15px;">
            <i class="fas fa-box-open" style="font-size: 60px; color: #ccc; margin-bottom: 20px;"></i>
            <h3 style="color: #666;">æ²¡æœ‰æ‰¾åˆ°äº§å“</h3>
            <p style="color: #999;">è¯·æ·»åŠ æ–°äº§å“æˆ–ä»APIåŠ è½½</p>
          </div>
        `;
        return;
      }
      
      grid.innerHTML = '';
      
      productsToShow.forEach(product => {
        const card = document.createElement('div');
        card.className = 'product-card';
        
        const imagePath = product.image ? `../images/products/shopee/${product.image}` : 
          'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="400" height="200" viewBox="0 0 400 200"><rect width="400" height="200" fill="%23f5f5f5"/><text x="200" y="100" font-family="Arial" font-size="16" text-anchor="middle" fill="%23999">æ— å›¾ç‰‡</text></svg>';
        
        const categoryIcons = {
          health: 'fas fa-heart',
          home: 'fas fa-home',
          electronic: 'fas fa-laptop',
          book: 'fas fa-book'
        };
        
        card.innerHTML = `
          <img src="${imagePath}" 
               alt="${product.name}" 
               class="product-image"
               onerror="this.src='data:image/svg+xml;utf8,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%22400%22 height=%22200%22 viewBox=%220 0 400 200%22><rect width=%22400%22 height=%22200%22 fill=%22%23f5f5f5%22/><text x=%22200%22 y=%22100%22 font-family=%22Arial%22 font-size=%2216%22 text-anchor=%22middle%22 fill=%22%23999%22>å›¾ç‰‡åŠ è½½å¤±è´¥</text></svg>'">
          <div class="product-info">
            <div class="product-name">${product.name}</div>
            <div class="product-price">RM ${Number(product.price).toFixed(2)}</div>
            <div class="product-details">
              <span><i class="fas fa-box"></i> åº“å­˜: ${product.stock}</span>
              <span><i class="${categoryIcons[product.category] || 'fas fa-tag'}"></i> ${getCategoryName(product.category)}</span>
            </div>
            <div class="product-actions">
              <button class="btn btn-primary" onclick="editProduct(${product.id})" style="padding: 8px 16px; font-size: 12px;">
                <i class="fas fa-edit"></i> ç¼–è¾‘
              </button>
              <button class="btn btn-danger" onclick="deleteProduct(${product.id})" style="padding: 8px 16px; font-size: 12px;">
                <i class="fas fa-trash"></i> åˆ é™¤
              </button>
              <button class="btn btn-success" onclick="syncSingleToApi(${product.id})" style="padding: 8px 16px; font-size: 12px;">
                <i class="fas fa-cloud-upload"></i> åŒæ­¥
              </button>
              ${product.link ? `
                <a href="${product.link}" target="_blank" class="btn btn-warning" style="padding: 8px 16px; font-size: 12px; text-decoration: none;">
                  <i class="fas fa-external-link-alt"></i> æŸ¥çœ‹
                </a>
              ` : ''}
            </div>
          </div>
        `;
        
        grid.appendChild(card);
      });
    }

    function getCategoryName(category) {
      const map = {
        'health': 'ä¿å¥å…»ç”Ÿ',
        'home': 'å®¶å±…ç”Ÿæ´»',
        'electronic': 'ç”µå­äº§å“',
        'book': 'å›¾ä¹¦æ–‡å…·'
      };
      return map[category] || category;
    }

    // æ˜¾ç¤ºæ¶ˆæ¯
    function showMessage(text, type = 'success') {
      const container = document.getElementById('messageContainer');
      const message = document.createElement('div');
      message.className = `message ${type}`;
      message.innerHTML = `<i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'times-circle' : 'exclamation-circle'}"></i> ${text}`;
      
      container.appendChild(message);
      
      setTimeout(() => {
        message.style.animation = 'slideIn 0.3s ease-out reverse';
        setTimeout(() => message.remove(), 300);
      }, 3000);
    }

    // ç¼–è¾‘äº§å“
    function editProduct(id) {
      const product = products.find(p => p.id === id);
      if (!product) return;
      
      const newName = prompt('è¾“å…¥æ–°çš„äº§å“åç§°:', product.name);
      if (newName === null) return;
      
      const newPrice = prompt('è¾“å…¥æ–°çš„ä»·æ ¼:', product.price);
      const newStock = prompt('è¾“å…¥æ–°çš„åº“å­˜:', product.stock);
      const newImage = prompt('è¾“å…¥æ–°çš„å›¾ç‰‡æ–‡ä»¶å:', product.image || '');
      const newLink = prompt('è¾“å…¥æ–°çš„Shopeeé“¾æ¥:', product.link || '');
      const newCategory = prompt('è¾“å…¥æ–°çš„åˆ†ç±» (health/home/electronic/book):', product.category);
      
      if (newName) product.name = newName;
      if (newPrice && !isNaN(newPrice)) product.price = parseFloat(newPrice);
      if (newStock && !isNaN(newStock)) product.stock = parseInt(newStock);
      if (newImage !== null) product.image = newImage;
      if (newLink !== null) product.link = newLink;
      if (newCategory && ['health', 'home', 'electronic', 'book'].includes(newCategory)) product.category = newCategory;
      
      updateDisplay();
      showMessage(`âœ… äº§å“ ID: ${id} æ›´æ–°æˆåŠŸ`, 'success');
    }

    // åˆ é™¤äº§å“
    function deleteProduct(id) {
      const product = products.find(p => p.id === id);
      if (!product) return;
      
      if (!confirm(`ç¡®å®šè¦åˆ é™¤äº§å“å—ï¼Ÿ\n\nID: ${product.id}\nåç§°: ${product.name}`)) return;
      
      products = products.filter(p => p.id !== id);
      updateDisplay();
      showMessage(`âœ… äº§å“ ID: ${id} åˆ é™¤æˆåŠŸ`, 'success');
    }

    // åŒæ­¥å•ä¸ªäº§å“åˆ°API
    async function syncSingleToApi(id) {
      const product = products.find(p => p.id === id);
      if (!product) return;
      
      if (!apiConfig.connected) {
        showMessage('âŒ APIæœªè¿æ¥', 'error');
        return;
      }
      
      try {
        await syncProductToApi(product);
        showMessage(`âœ… äº§å“ ID: ${id} åŒæ­¥æˆåŠŸ`, 'success');
      } catch (error) {
        showMessage(`âŒ åŒæ­¥å¤±è´¥: ${error.message}`, 'error');
      }
    }

    // å¯¼å‡ºæ•°æ®
    function exportData() {
      if (products.length === 0) {
        showMessage('âŒ æ²¡æœ‰æ•°æ®å¯å¯¼å‡º', 'error');
        return;
      }
      
      const dataStr = JSON.stringify(products, null, 2);
      const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
      
      const linkElement = document.createElement('a');
      linkElement.setAttribute('href', dataUri);
      linkElement.setAttribute('download', 'shopee_products_export.json');
      linkElement.click();
      
      showMessage('âœ… æ•°æ®å·²å¯¼å‡º', 'success');
    }

    // æ¸…ç©ºè¡¨å•
    function clearForm() {
      document.getElementById('addForm').reset();
      showMessage('è¡¨å•å·²æ¸…ç©º', 'success');
    }

    // æœç´¢è¿‡æ»¤
    function filterProducts() {
      updateDisplay();
    }

    // é¡µé¢åŠ è½½
    window.onload = function() {
      initApiConfig();
      console.log('Shopee APIç‰ˆç®¡ç†ç³»ç»Ÿå·²åŠ è½½');
    };
  </script>
</body>
</html>