<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¨‚å–®ç®¡ç†å¾Œå° | MYX Shop</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Microsoft JhengHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .admin-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        /* ç®¡ç†å“¡é ­éƒ¨ */
        .admin-header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 20px 30px;
            border-bottom: 3px solid #2196F3;
        }
        
        .admin-title {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .admin-title h1 {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 1.5rem;
        }
        
        .admin-controls {
            display: flex;
            gap: 10px;
        }
        
        .admin-btn {
            background: rgba(255,255,255,0.15);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            transition: all 0.3s;
        }
        
        .admin-btn:hover {
            background: rgba(255,255,255,0.25);
            transform: translateY(-2px);
        }
        
        /* çµ±è¨ˆå¡ç‰‡ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            padding: 20px 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            border: 1px solid #e0e0e0;
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-number {
            font-size: 2.2rem;
            font-weight: bold;
            color: #2c3e50;
            margin: 10px 0;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }
        
        /* è¨‚å–®ç®¡ç†å€åŸŸ */
        .order-management {
            padding: 30px;
        }
        
        .section-title {
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* æœç´¢å’Œç¯©é¸ */
        .search-filter {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .search-box, .filter-select {
            flex: 1;
            min-width: 200px;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 0.9rem;
        }
        
        /* è¨‚å–®è¡¨æ ¼ */
        .orders-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .orders-table th {
            background: #f5f7fa;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #2c3e50;
            border-bottom: 2px solid #e0e0e0;
            font-size: 0.9rem;
        }
        
        .orders-table td {
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
            font-size: 0.9rem;
        }
        
        .orders-table tr:hover {
            background: #f8f9fa;
        }
        
        /* ç‹€æ…‹æ¨™ç±¤ */
        .status-badge {
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-block;
        }
        
        .status-paid {
            background: #E8F5E9;
            color: #2E7D32;
        }
        
        .status-pending {
            background: #FFF3E0;
            color: #E65100;
        }
        
        .status-expired {
            background: #FFEBEE;
            color: #C62828;
        }
        
        /* æ“ä½œæŒ‰éˆ• */
        .action-buttons {
            display: flex;
            gap: 8px;
        }
        
        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s;
        }
        
        .btn-activate {
            background: #4CAF50;
            color: white;
        }
        
        .btn-activate:hover {
            background: #45a049;
        }
        
        .btn-extend {
            background: #2196F3;
            color: white;
        }
        
        .btn-extend:hover {
            background: #1976D2;
        }
        
        .btn-delete {
            background: #F44336;
            color: white;
        }
        
        .btn-delete:hover {
            background: #d32f2f;
        }
        
        /* ç©ºç‹€æ…‹ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }
        
        .empty-state .icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.3;
        }
        
        /* æ•¸æ“šç®¡ç†å€åŸŸ */
        .data-management {
            padding: 30px;
            background: #f8f9fa;
            border-top: 1px solid #e0e0e0;
        }
        
        .data-actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        
        .data-action-btn {
            background: white;
            border: 1px solid #ddd;
            padding: 15px 25px;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
            flex: 1;
            min-width: 200px;
        }
        
        .data-action-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            border-color: #2196F3;
        }
        
        .data-action-btn .icon {
            font-size: 1.5rem;
            color: #2196F3;
        }
        
        /* æ•¸æ“šé è¦½ */
        .data-preview {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid #ddd;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .json-view {
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            white-space: pre-wrap;
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        /* ç³»çµ±è¨­ç½® */
        .system-settings {
            padding: 30px;
            border-top: 1px solid #e0e0e0;
        }
        
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .setting-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #ddd;
        }
        
        .setting-card h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .setting-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        
        /* æ—¥èªŒå€åŸŸ */
        .logs-section {
            padding: 30px;
            background: #f8f9fa;
            border-top: 1px solid #e0e0e0;
        }
        
        .logs-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid #ddd;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .log-entry {
            padding: 10px;
            border-bottom: 1px solid #eee;
            font-size: 0.85rem;
            font-family: 'Courier New', monospace;
        }
        
        .log-time {
            color: #666;
            margin-right: 15px;
        }
        
        .log-info { color: #2196F3; }
        .log-success { color: #4CAF50; }
        .log-warning { color: #FF9800; }
        .log-error { color: #F44336; }
        
        /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (max-width: 768px) {
            .admin-container {
                border-radius: 10px;
            }
            
            .admin-title {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .search-filter {
                flex-direction: column;
            }
            
            .orders-table {
                display: block;
                overflow-x: auto;
            }
            
            .data-actions {
                flex-direction: column;
            }
            
            .data-action-btn {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- ç®¡ç†å“¡é ­éƒ¨ -->
        <div class="admin-header">
            <div class="admin-title">
                <h1>
                    <span>ğŸ”§</span>
                    MYX Shop è¨‚å–®ç®¡ç†å¾Œå°
                </h1>
                <div class="admin-controls">
                    <button class="admin-btn" onclick="refreshData()">
                        <span>ğŸ”„</span>
                        åˆ·æ–°æ•¸æ“š
                    </button>
                    <button class="admin-btn" onclick="exportData()">
                        <span>ğŸ“¥</span>
                        å°å‡ºæ•¸æ“š
                    </button>
                    <button class="admin-btn" onclick="logout()">
                        <span>ğŸšª</span>
                        é€€å‡ºç™»éŒ„
                    </button>
                </div>
            </div>
            <div style="margin-top: 10px; font-size: 0.9rem; opacity: 0.9;">
                ç³»çµ±ç‰ˆæœ¬: 2.1 | SSMè¨»å†Šä¼æ¥­: JM1034075-K | æœ€å¾Œæ›´æ–°: <span id="lastUpdate">è¼‰å…¥ä¸­...</span>
            </div>
        </div>
        
        <!-- çµ±è¨ˆå¡ç‰‡ -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="totalOrders">0</div>
                <div class="stat-label">ç¸½è¨‚å–®æ•¸</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="activeOrders">0</div>
                <div class="stat-label">æ´»èºè¨‚å–®</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="todayOrders">0</div>
                <div class="stat-label">ä»Šæ—¥æ–°å¢</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalRevenue">RM 0</div>
                <div class="stat-label">ç¸½æ”¶å…¥</div>
            </div>
        </div>
        
        <!-- è¨‚å–®ç®¡ç† -->
        <div class="order-management">
            <h2 class="section-title">
                <span>ğŸ“‹</span>
                è¨‚å–®ç®¡ç†
            </h2>
            
            <!-- æœç´¢å’Œç¯©é¸ -->
            <div class="search-filter">
                <input type="text" id="searchOrders" class="search-box" placeholder="æœç´¢æ”¯ä»˜IDã€è¨­å‚™IDæˆ–ç‹€æ…‹...">
                <select id="filterStatus" class="filter-select">
                    <option value="">æ‰€æœ‰ç‹€æ…‹</option>
                    <option value="active">å·²æ¿€æ´»</option>
                    <option value="pending">å¾…ç¢ºèª</option>
                    <option value="expired">å·²éæœŸ</option>
                </select>
                <button class="admin-btn" onclick="clearFilters()">
                    <span>ğŸ§¹</span>
                    æ¸…é™¤ç¯©é¸
                </button>
            </div>
            
            <!-- è¨‚å–®è¡¨æ ¼ -->
            <div class="table-container">
                <table class="orders-table">
                    <thead>
                        <tr>
                            <th>æ”¯ä»˜ID</th>
                            <th>è¨­å‚™ID</th>
                            <th>æ”¯ä»˜æ™‚é–“</th>
                            <th>åˆ°æœŸæ™‚é–“</th>
                            <th>å‰©é¤˜å¤©æ•¸</th>
                            <th>ç‹€æ…‹</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="ordersTableBody">
                        <!-- è¨‚å–®æ•¸æ“šå°‡åœ¨é€™è£¡å‹•æ…‹ç”Ÿæˆ -->
                    </tbody>
                </table>
            </div>
            
            <!-- ç©ºç‹€æ…‹ -->
            <div id="emptyOrders" class="empty-state" style="display: none;">
                <div class="icon">ğŸ“­</div>
                <h3>æ²’æœ‰æ‰¾åˆ°è¨‚å–®</h3>
                <p>ç›®å‰é‚„æ²’æœ‰ä»»ä½•è¨‚å–®è¨˜éŒ„</p>
            </div>
        </div>
        
        <!-- æ•¸æ“šç®¡ç† -->
        <div class="data-management">
            <h2 class="section-title">
                <span>ğŸ“Š</span>
                æ•¸æ“šç®¡ç†
            </h2>
            
            <div class="data-actions">
                <button class="data-action-btn" onclick="viewAllData()">
                    <div class="icon">ğŸ‘ï¸</div>
                    <div>
                        <div style="font-weight: bold;">æŸ¥çœ‹æ‰€æœ‰æ•¸æ“š</div>
                        <div style="font-size: 0.8rem; color: #666;">æŸ¥çœ‹æœ¬åœ°å­˜å„²çš„æ‰€æœ‰æ•¸æ“š</div>
                    </div>
                </button>
                
                <button class="data-action-btn" onclick="clearAllData()">
                    <div class="icon">ğŸ—‘ï¸</div>
                    <div>
                        <div style="font-weight: bold;">æ¸…é™¤æ‰€æœ‰æ•¸æ“š</div>
                        <div style="font-size: 0.8rem; color: #666;">æ¸…é™¤æ‰€æœ‰è¨‚å–®å’Œè¨ªå•æ•¸æ“š</div>
                    </div>
                </button>
                
                <button class="data-action-btn" onclick="generateTestData()">
                    <div class="icon">ğŸ§ª</div>
                    <div>
                        <div style="font-weight: bold;">ç”Ÿæˆæ¸¬è©¦æ•¸æ“š</div>
                        <div style="font-size: 0.8rem; color: #666;">å‰µå»ºç”¨æ–¼æ¸¬è©¦çš„ç¤ºä¾‹è¨‚å–®</div>
                    </div>
                </button>
            </div>
            
            <!-- æ•¸æ“šé è¦½ -->
            <div id="dataPreview" class="data-preview" style="display: none;">
                <h4 style="margin-bottom: 15px; color: #2c3e50;">æ•¸æ“šé è¦½</h4>
                <div id="jsonViewer" class="json-view"></div>
                <button onclick="document.getElementById('dataPreview').style.display='none'" class="admin-btn" style="margin-top: 10px;">
                    é—œé–‰é è¦½
                </button>
            </div>
        </div>
        
        <!-- ç³»çµ±è¨­ç½® -->
        <div class="system-settings">
            <h2 class="section-title">
                <span>âš™ï¸</span>
                ç³»çµ±è¨­ç½®
            </h2>
            
            <div class="settings-grid">
                <div class="setting-card">
                    <h4><span>ğŸ’°</span> æ”¯ä»˜è¨­ç½®</h4>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-size: 0.9rem;">æœå‹™åƒ¹æ ¼ (RM)</label>
                        <input type="number" id="servicePrice" class="setting-input" value="5" min="1" max="100">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-size: 0.9rem;">æœå‹™å¤©æ•¸</label>
                        <input type="number" id="serviceDays" class="setting-input" value="30" min="1" max="365">
                    </div>
                    <button onclick="saveSettings()" class="admin-btn" style="margin-top: 10px; width: 100%;">
                        ä¿å­˜è¨­ç½®
                    </button>
                </div>
                
                <div class="setting-card">
                    <h4><span>ğŸ”</span> å®‰å…¨è¨­ç½®</h4>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-size: 0.9rem;">ç®¡ç†å“¡å¯†ç¢¼</label>
                        <input type="password" id="adminPassword" class="setting-input" placeholder="è¼¸å…¥æ–°å¯†ç¢¼">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-size: 0.9rem;">ç¢ºèªå¯†ç¢¼</label>
                        <input type="password" id="confirmPassword" class="setting-input" placeholder="ç¢ºèªæ–°å¯†ç¢¼">
                    </div>
                    <button onclick="changePassword()" class="admin-btn" style="margin-top: 10px; width: 100%;">
                        ä¿®æ”¹å¯†ç¢¼
                    </button>
                </div>
                
                <div class="setting-card">
                    <h4><span>ğŸ“±</span> è¯ç¹«æ–¹å¼</h4>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-size: 0.9rem;">WhatsAppè™Ÿç¢¼</label>
                        <input type="text" id="whatsappNumber" class="setting-input" value="+60196819069">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-size: 0.9rem;">å®¢æœæ™‚é–“</label>
                        <input type="text" id="serviceHours" class="setting-input" value="9:00 - 18:00">
                    </div>
                    <button onclick="saveContactInfo()" class="admin-btn" style="margin-top: 10px; width: 100%;">
                        ä¿å­˜è¯ç¹«æ–¹å¼
                    </button>
                </div>
            </div>
        </div>
        
        <!-- ç³»çµ±æ—¥èªŒ -->
        <div class="logs-section">
            <h2 class="section-title">
                <span>ğŸ“</span>
                ç³»çµ±æ—¥èªŒ
            </h2>
            
            <div class="logs-container">
                <div id="logsList">
                    <div class="log-entry">
                        <span class="log-time">[è¼‰å…¥ä¸­...]</span>
                        <span class="log-info">ç³»çµ±æ­£åœ¨åŠ è¼‰æ—¥èªŒ...</span>
                    </div>
                </div>
            </div>
            
            <button onclick="clearLogs()" class="admin-btn" style="margin-top: 10px;">
                <span>ğŸ§¹</span>
                æ¸…é™¤æ—¥èªŒ
            </button>
        </div>
    </div>

    <script>
        // ==================== ç®¡ç†å“¡ç³»çµ± ====================
        class AdminSystem {
            constructor() {
                this.orders = [];
                this.filteredOrders = [];
                this.settings = this.loadSettings();
                this.logs = this.loadLogs();
                this.currentFilter = '';
                this.currentStatus = '';
            }
            
            // åˆå§‹åŒ–ç³»çµ±
            init() {
                this.checkAdminAccess();
                this.loadOrders();
                this.updateStatistics();
                this.updateLogs();
                this.updateLastUpdate();
                
                // è¨­ç½®å®šæ™‚åˆ·æ–°
                setInterval(() => {
                    this.loadOrders();
                    this.updateLastUpdate();
                }, 30000);
            }
            
            // æª¢æŸ¥ç®¡ç†å“¡è¨ªå•æ¬Šé™ï¼ˆå·²ä¿®æ­£ï¼‰
            checkAdminAccess() {
                // æª¢æŸ¥ç®¡ç†å“¡ä»¤ç‰Œ
                const token = sessionStorage.getItem('admin_token');
                const expiry = sessionStorage.getItem('admin_expiry');
                
                if (!token || token !== 'MYX2025_ADMIN') {
                    this.showAccessDenied();
                    return false;
                }
                
                // æª¢æŸ¥æ˜¯å¦éæœŸ
                if (expiry && Date.now() > parseInt(expiry)) {
                    sessionStorage.removeItem('admin_token');
                    sessionStorage.removeItem('admin_expiry');
                    sessionStorage.removeItem('admin_login_time');
                    this.showSessionExpired();
                    return false;
                }
                
                return true;
            }
            
            showAccessDenied() {
                // é¡¯ç¤ºè¨ªå•è¢«æ‹’çµ•çš„ç•Œé¢
                document.body.innerHTML = '';
                
                const accessDeniedHTML = `
                    <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; padding: 20px;">
                        <div style="background: white; padding: 40px; border-radius: 20px; max-width: 500px; width: 100%; text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
                            <div style="font-size: 80px; margin-bottom: 20px; color: #FF5722;">ğŸ”’</div>
                            <h2 style="color: #333; margin-bottom: 15px;">ç®¡ç†å“¡è¨ªå•è¢«æ‹’çµ•</h2>
                            <p style="color: #666; margin-bottom: 25px; line-height: 1.6;">
                                è«‹å¾é¦–é çš„ç®¡ç†å¾Œå°æŒ‰éˆ•é€²å…¥ï¼Œä¸¦è¼¸å…¥æ­£ç¢ºçš„ç®¡ç†å“¡å¯†ç¢¼ã€‚
                            </p>
                            
                            <div style="background: #E3F2FD; padding: 20px; border-radius: 10px; margin: 20px 0; border-left: 4px solid #2196F3;">
                                <h4 style="color: #1976D2; margin-bottom: 10px;">æ­£ç¢ºçš„é€²å…¥æ–¹å¼ï¼š</h4>
                                <ol style="text-align: left; margin: 10px 0; padding-left: 20px;">
                                    <li>è¨ªå• <strong>bursa.html</strong></li>
                                    <li>é»æ“Šå³ä¸Šè§’çš„ã€Œç®¡ç†å¾Œå°ã€æŒ‰éˆ•</li>
                                    <li>è¼¸å…¥ç®¡ç†å“¡å¯†ç¢¼ï¼š<strong>MYX2025</strong></li>
                                    <li>ç³»çµ±å°‡è‡ªå‹•è·³è½‰åˆ°æ­¤é é¢</li>
                                </ol>
                            </div>
                            
                            <button onclick="window.location.href='../bursa.html'" style="background: linear-gradient(135deg, #FF5722, #E64A19); color: white; border: none; padding: 15px 40px; border-radius: 30px; font-size: 1.1rem; font-weight: bold; cursor: pointer; transition: all 0.3s;">
                                è¿”å›é¦–é é€²å…¥ç®¡ç†å¾Œå°
                            </button>
                            
                            <p style="margin-top: 25px; font-size: 0.9rem; color: #999;">
                                å¦‚æœæ‚¨å¿˜è¨˜äº†ç®¡ç†å“¡å¯†ç¢¼ï¼Œè«‹è¯ç¹«ç³»çµ±ç®¡ç†å“¡ã€‚
                            </p>
                        </div>
                    </div>
                `;
                
                document.body.innerHTML = accessDeniedHTML;
            }
            
            showSessionExpired() {
                document.body.innerHTML = '';
                
                const sessionExpiredHTML = `
                    <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #FF9800, #F57C00); display: flex; align-items: center; justify-content: center; padding: 20px;">
                        <div style="background: white; padding: 40px; border-radius: 20px; max-width: 500px; width: 100%; text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
                            <div style="font-size: 80px; margin-bottom: 20px; color: #FF9800;">â°</div>
                            <h2 style="color: #333; margin-bottom: 15px;">ç®¡ç†å“¡æœƒè©±å·²éæœŸ</h2>
                            <p style="color: #666; margin-bottom: 25px; line-height: 1.6;">
                                ç®¡ç†å“¡ç™»éŒ„æœƒè©±å·²è¶…é24å°æ™‚ï¼Œç‚ºå®‰å…¨èµ·è¦‹éœ€è¦é‡æ–°ç™»éŒ„ã€‚
                            </p>
                            
                            <div style="background: #FFF3E0; padding: 20px; border-radius: 10px; margin: 20px 0; border-left: 4px solid #FF9800;">
                                <p style="font-weight: bold; color: #E65100;">å®‰å…¨æç¤ºï¼š</p>
                                <p>ç®¡ç†å“¡æœƒè©±24å°æ™‚å¾Œè‡ªå‹•éæœŸï¼Œä»¥ä¿éšœç³»çµ±å®‰å…¨ã€‚</p>
                            </div>
                            
                            <button onclick="window.location.href='../bursa.html'" style="background: #FF9800; color: white; border: none; padding: 15px 40px; border-radius: 30px; font-size: 1.1rem; font-weight: bold; cursor: pointer;">
                                é‡æ–°ç™»éŒ„ç®¡ç†å¾Œå°
                            </button>
                        </div>
                    </div>
                `;
                
                document.body.innerHTML = sessionExpiredHTML;
            }
            
            // è¼‰å…¥è¨‚å–®æ•¸æ“š
            loadOrders() {
                this.orders = [];
                
                // å¾localStorageè®€å–æ‰€æœ‰è¨‚å–®
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    
                    if (key.startsWith('payment_') || key === 'myxshop_access') {
                        try {
                            const data = JSON.parse(localStorage.getItem(key));
                            this.processOrderData(data, key);
                        } catch (e) {
                            this.addLog('éŒ¯èª¤', `è§£ææ•¸æ“šå¤±æ•—: ${key}`);
                        }
                    }
                }
                
                this.applyFilters();
                this.displayOrders();
            }
            
            // è™•ç†è¨‚å–®æ•¸æ“š
            processOrderData(data, key) {
                if (data.paymentId) {
                    // é€™æ˜¯å–®å€‹è¨‚å–®
                    const order = {
                        id: data.paymentId,
                        paymentId: data.paymentId,
                        deviceId: data.deviceId || 'N/A',
                        paidAt: data.paidAt ? new Date(data.paidAt) : new Date(),
                        expiry: data.expiry ? new Date(data.expiry) : new Date(),
                        amount: data.amount || 5,
                        status: data.status || 'active'
                    };
                    
                    this.orders.push(order);
                } else if (key === 'myxshop_access') {
                    // é€™æ˜¯ç•¶å‰è¨ªå•æ•¸æ“š
                    const order = {
                        id: data.paymentId || 'current_access',
                        paymentId: data.paymentId || 'current_access',
                        deviceId: data.deviceId || 'N/A',
                        paidAt: data.paidAt ? new Date(data.paidAt) : new Date(),
                        expiry: data.expiry ? new Date(data.expiry) : new Date(),
                        amount: data.amount || 5,
                        status: 'active'
                    };
                    
                    this.orders.push(order);
                }
            }
            
            // æ‡‰ç”¨ç¯©é¸
            applyFilters() {
                this.filteredOrders = this.orders.filter(order => {
                    let matches = true;
                    
                    // æœç´¢ç¯©é¸
                    if (this.currentFilter) {
                        const searchLower = this.currentFilter.toLowerCase();
                        matches = matches && (
                            order.paymentId.toLowerCase().includes(searchLower) ||
                            order.deviceId.toLowerCase().includes(searchLower)
                        );
                    }
                    
                    // ç‹€æ…‹ç¯©é¸
                    if (this.currentStatus) {
                        matches = matches && (this.getOrderStatus(order) === this.currentStatus);
                    }
                    
                    return matches;
                });
                
                // æŒ‰æ”¯ä»˜æ™‚é–“æ’åº
                this.filteredOrders.sort((a, b) => b.paidAt - a.paidAt);
            }
            
            // ç²å–è¨‚å–®ç‹€æ…‹
            getOrderStatus(order) {
                const now = new Date();
                const expiry = new Date(order.expiry);
                
                if (expiry < now) {
                    return 'expired';
                } else if (order.status === 'pending_verification') {
                    return 'pending';
                } else {
                    return 'active';
                }
            }
            
            // é¡¯ç¤ºè¨‚å–®
            displayOrders() {
                const tableBody = document.getElementById('ordersTableBody');
                const emptyState = document.getElementById('emptyOrders');
                
                if (this.filteredOrders.length === 0) {
                    tableBody.innerHTML = '';
                    emptyState.style.display = 'block';
                    return;
                }
                
                emptyState.style.display = 'none';
                
                let html = '';
                
                this.filteredOrders.forEach(order => {
                    const now = new Date();
                    const expiry = new Date(order.expiry);
                    const daysLeft = Math.ceil((expiry - now) / (1000 * 60 * 60 * 24));
                    const status = this.getOrderStatus(order);
                    
                    html += `
                        <tr>
                            <td><strong>${order.paymentId}</strong></td>
                            <td><code>${order.deviceId}</code></td>
                            <td>${order.paidAt.toLocaleString()}</td>
                            <td>${expiry.toLocaleDateString()}</td>
                            <td>${daysLeft > 0 ? `<span style="color: #4CAF50;">${daysLeft}å¤©</span>` : '<span style="color: #F44336;">å·²éæœŸ</span>'}</td>
                            <td>
                                <span class="status-badge status-${status}">
                                    ${status === 'active' ? 'å·²æ¿€æ´»' : status === 'pending' ? 'å¾…ç¢ºèª' : 'å·²éæœŸ'}
                                </span>
                            </td>
                            <td>
                                <div class="action-buttons">
                                    ${status === 'pending' ? `
                                        <button class="action-btn btn-activate" onclick="adminSystem.activateOrder('${order.id}')">
                                            æ¿€æ´»
                                        </button>
                                    ` : ''}
                                    
                                    ${status === 'active' ? `
                                        <button class="action-btn btn-extend" onclick="adminSystem.extendOrder('${order.id}')">
                                            å»¶é•·
                                        </button>
                                    ` : ''}
                                    
                                    <button class="action-btn btn-delete" onclick="adminSystem.deleteOrder('${order.id}')">
                                        åˆªé™¤
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                });
                
                tableBody.innerHTML = html;
            }
            
            // æ›´æ–°çµ±è¨ˆæ•¸æ“š
            updateStatistics() {
                const now = new Date();
                const todayStart = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                
                const activeOrders = this.orders.filter(order => {
                    const expiry = new Date(order.expiry);
                    return expiry > now;
                });
                
                const todayOrders = this.orders.filter(order => {
                    const paidAt = new Date(order.paidAt);
                    return paidAt >= todayStart;
                });
                
                const totalRevenue = this.orders.reduce((sum, order) => sum + (order.amount || 5), 0);
                
                document.getElementById('totalOrders').textContent = this.orders.length;
                document.getElementById('activeOrders').textContent = activeOrders.length;
                document.getElementById('todayOrders').textContent = todayOrders.length;
                document.getElementById('totalRevenue').textContent = `RM ${totalRevenue}`;
            }
            
            // æ¿€æ´»è¨‚å–®
            activateOrder(orderId) {
                if (confirm(`ç¢ºå®šè¦æ¿€æ´»è¨‚å–® ${orderId} å—ï¼Ÿ`)) {
                    // æŸ¥æ‰¾ä¸¦æ›´æ–°è¨‚å–®
                    this.orders.forEach(order => {
                        if (order.id === orderId) {
                            order.status = 'active';
                            
                            // æ›´æ–°localStorage
                            const accessData = localStorage.getItem('myxshop_access');
                            if (accessData) {
                                try {
                                    const data = JSON.parse(accessData);
                                    if (data.paymentId === orderId) {
                                        data.status = 'active';
                                        localStorage.setItem('myxshop_access', JSON.stringify(data));
                                    }
                                } catch (e) {}
                            }
                            
                            this.addLog('æˆåŠŸ', `å·²æ¿€æ´»è¨‚å–®: ${orderId}`);
                        }
                    });
                    
                    this.loadOrders();
                }
            }
            
            // å»¶é•·è¨‚å–®
            extendOrder(orderId) {
                const days = prompt('è«‹è¼¸å…¥è¦å»¶é•·çš„å¤©æ•¸:', '30');
                if (days && !isNaN(days) && parseInt(days) > 0) {
                    this.orders.forEach(order => {
                        if (order.id === orderId) {
                            const expiry = new Date(order.expiry);
                            expiry.setDate(expiry.getDate() + parseInt(days));
                            order.expiry = expiry;
                            
                            // æ›´æ–°localStorage
                            const accessData = localStorage.getItem('myxshop_access');
                            if (accessData) {
                                try {
                                    const data = JSON.parse(accessData);
                                    if (data.paymentId === orderId) {
                                        data.expiry = expiry.toISOString();
                                        localStorage.setItem('myxshop_access', JSON.stringify(data));
                                    }
                                } catch (e) {}
                            }
                            
                            this.addLog('æˆåŠŸ', `å·²å»¶é•·è¨‚å–® ${orderId} ${days}å¤©`);
                        }
                    });
                    
                    this.loadOrders();
                }
            }
            
            // åˆªé™¤è¨‚å–®
            deleteOrder(orderId) {
                if (confirm(`ç¢ºå®šè¦åˆªé™¤è¨‚å–® ${orderId} å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤éŠ·ï¼`)) {
                    // å¾localStorageåˆªé™¤
                    localStorage.removeItem(`payment_${orderId}`);
                    
                    // å¦‚æœåˆªé™¤çš„æ˜¯ç•¶å‰è¨ªå•æ•¸æ“š
                    const accessData = localStorage.getItem('myxshop_access');
                    if (accessData) {
                        try {
                            const data = JSON.parse(accessData);
                            if (data.paymentId === orderId) {
                                localStorage.removeItem('myxshop_access');
                                sessionStorage.removeItem('myxshop_token');
                            }
                        } catch (e) {}
                    }
                    
                    this.addLog('è­¦å‘Š', `å·²åˆªé™¤è¨‚å–®: ${orderId}`);
                    this.loadOrders();
                }
            }
            
            // åŠ è¼‰è¨­ç½®
            loadSettings() {
                const saved = localStorage.getItem('admin_settings');
                if (saved) {
                    return JSON.parse(saved);
                }
                
                return {
                    servicePrice: 5,
                    serviceDays: 30,
                    whatsappNumber: '+60196819069',
                    serviceHours: '9:00 - 18:00'
                };
            }
            
            // ä¿å­˜è¨­ç½®
            saveSettings() {
                const settings = {
                    servicePrice: parseInt(document.getElementById('servicePrice').value) || 5,
                    serviceDays: parseInt(document.getElementById('serviceDays').value) || 30,
                    whatsappNumber: document.getElementById('whatsappNumber').value || '+60196819069',
                    serviceHours: document.getElementById('serviceHours').value || '9:00 - 18:00'
                };
                
                localStorage.setItem('admin_settings', JSON.stringify(settings));
                this.settings = settings;
                
                this.addLog('æˆåŠŸ', 'å·²ä¿å­˜ç³»çµ±è¨­ç½®');
                alert('è¨­ç½®å·²ä¿å­˜ï¼');
            }
            
            // ä¿®æ”¹å¯†ç¢¼
            changePassword() {
                const password = document.getElementById('adminPassword').value;
                const confirmPassword = document.getElementById('confirmPassword').value;
                
                if (!password || !confirmPassword) {
                    alert('è«‹è¼¸å…¥å¯†ç¢¼');
                    return;
                }
                
                if (password !== confirmPassword) {
                    alert('å…©æ¬¡è¼¸å…¥çš„å¯†ç¢¼ä¸ä¸€è‡´');
                    return;
                }
                
                localStorage.setItem('admin_password', btoa(password));
                
                document.getElementById('adminPassword').value = '';
                document.getElementById('confirmPassword').value = '';
                
                this.addLog('æˆåŠŸ', 'å·²ä¿®æ”¹ç®¡ç†å“¡å¯†ç¢¼');
                alert('å¯†ç¢¼ä¿®æ”¹æˆåŠŸï¼');
            }
            
            // ä¿å­˜è¯ç¹«æ–¹å¼
            saveContactInfo() {
                this.saveSettings();
            }
            
            // æŸ¥çœ‹æ‰€æœ‰æ•¸æ“š
            viewAllData() {
                const allData = {};
                
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    try {
                        allData[key] = JSON.parse(localStorage.getItem(key));
                    } catch (e) {
                        allData[key] = localStorage.getItem(key);
                    }
                }
                
                document.getElementById('jsonViewer').textContent = 
                    JSON.stringify(allData, null, 2);
                document.getElementById('dataPreview').style.display = 'block';
            }
            
            // æ¸…é™¤æ‰€æœ‰æ•¸æ“š
            clearAllData() {
                if (confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰æ•¸æ“šå—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤éŠ·ï¼')) {
                    localStorage.clear();
                    sessionStorage.clear();
                    
                    this.addLog('è­¦å‘Š', 'å·²æ¸…é™¤æ‰€æœ‰ç³»çµ±æ•¸æ“š');
                    alert('æ‰€æœ‰æ•¸æ“šå·²æ¸…é™¤ï¼');
                    this.loadOrders();
                }
            }
            
            // ç”Ÿæˆæ¸¬è©¦æ•¸æ“š
            generateTestData() {
                const testOrders = [
                    {
                        paymentId: 'PAY_TEST_001',
                        deviceId: 'DEV_TEST001',
                        paidAt: new Date().toISOString(),
                        expiry: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString(),
                        amount: 5,
                        status: 'active'
                    },
                    {
                        paymentId: 'PAY_TEST_002',
                        deviceId: 'DEV_TEST002',
                        paidAt: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString(),
                        expiry: new Date(Date.now() + 25 * 24 * 60 * 60 * 1000).toISOString(),
                        amount: 5,
                        status: 'active'
                    }
                ];
                
                testOrders.forEach(order => {
                    localStorage.setItem(`payment_${order.paymentId}`, JSON.stringify(order));
                });
                
                this.addLog('ä¿¡æ¯', 'å·²ç”Ÿæˆæ¸¬è©¦æ•¸æ“š');
                this.loadOrders();
            }
            
            // åŠ è¼‰æ—¥èªŒ
            loadLogs() {
                const saved = localStorage.getItem('admin_logs');
                if (saved) {
                    return JSON.parse(saved);
                }
                
                return [
                    {
                        time: new Date().toISOString(),
                        type: 'ä¿¡æ¯',
                        message: 'ç³»çµ±åˆå§‹åŒ–å®Œæˆ'
                    }
                ];
            }
            
            // æ·»åŠ æ—¥èªŒ
            addLog(type, message) {
                const logEntry = {
                    time: new Date().toISOString(),
                    type: type,
                    message: message
                };
                
                this.logs.unshift(logEntry);
                
                // ä¿æŒæ—¥èªŒæ•¸é‡ä¸è¶…é100æ¢
                if (this.logs.length > 100) {
                    this.logs = this.logs.slice(0, 100);
                }
                
                localStorage.setItem('admin_logs', JSON.stringify(this.logs));
                this.updateLogs();
            }
            
            // æ›´æ–°æ—¥èªŒé¡¯ç¤º
            updateLogs() {
                const logsList = document.getElementById('logsList');
                let html = '';
                
                this.logs.forEach(log => {
                    const time = new Date(log.time);
                    const timeStr = time.toLocaleString();
                    
                    html += `
                        <div class="log-entry">
                            <span class="log-time">[${timeStr}]</span>
                            <span class="log-${log.type.toLowerCase()}">${log.message}</span>
                        </div>
                    `;
                });
                
                logsList.innerHTML = html;
            }
            
            // æ¸…é™¤æ—¥èªŒ
            clearLogs() {
                if (confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰æ—¥èªŒå—ï¼Ÿ')) {
                    this.logs = [];
                    localStorage.removeItem('admin_logs');
                    this.updateLogs();
                    this.addLog('ä¿¡æ¯', 'å·²æ¸…é™¤æ‰€æœ‰æ—¥èªŒ');
                }
            }
            
            // æ›´æ–°æœ€å¾Œæ›´æ–°æ™‚é–“
            updateLastUpdate() {
                const now = new Date();
                document.getElementById('lastUpdate').textContent = now.toLocaleString();
            }
            
            // å°å‡ºæ•¸æ“š
            exportData() {
                const exportData = {
                    orders: this.orders,
                    settings: this.settings,
                    logs: this.logs,
                    exportTime: new Date().toISOString()
                };
                
                const dataStr = JSON.stringify(exportData, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = `myxshop_data_${new Date().getTime()}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
                
                this.addLog('æˆåŠŸ', 'å·²å°å‡ºç³»çµ±æ•¸æ“š');
            }
            
            // åˆ·æ–°æ•¸æ“š
            refreshData() {
                this.loadOrders();
                this.addLog('ä¿¡æ¯', 'æ‰‹å‹•åˆ·æ–°æ•¸æ“š');
            }
        }
        
        // ==================== å…¨å±€å‡½æ•¸ ====================
        function logout() {
            sessionStorage.removeItem('admin_token');
            sessionStorage.removeItem('admin_expiry');
            sessionStorage.removeItem('admin_login_time');
            alert('å·²é€€å‡ºç®¡ç†å¾Œå°');
            window.location.href = '../bursa.html';
        }
        
        function clearFilters() {
            document.getElementById('searchOrders').value = '';
            document.getElementById('filterStatus').value = '';
            adminSystem.currentFilter = '';
            adminSystem.currentStatus = '';
            adminSystem.applyFilters();
            adminSystem.displayOrders();
        }
        
        // ==================== é é¢åˆå§‹åŒ– ====================
        let adminSystem;
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ç®¡ç†å¾Œå°é é¢å·²è¼‰å…¥');
            
            // åˆå§‹åŒ–ç®¡ç†ç³»çµ±
            adminSystem = new AdminSystem();
            adminSystem.init();
            
            // ç¶å®šæœç´¢å’Œç¯©é¸äº‹ä»¶
            document.getElementById('searchOrders').addEventListener('input', function(e) {
                adminSystem.currentFilter = e.target.value;
                adminSystem.applyFilters();
                adminSystem.displayOrders();
            });
            
            document.getElementById('filterStatus').addEventListener('change', function(e) {
                adminSystem.currentStatus = e.target.value;
                adminSystem.applyFilters();
                adminSystem.displayOrders();
            });
            
            // åŠ è¼‰è¨­ç½®åˆ°è¡¨å–®
            document.getElementById('servicePrice').value = adminSystem.settings.servicePrice;
            document.getElementById('serviceDays').value = adminSystem.settings.serviceDays;
            document.getElementById('whatsappNumber').value = adminSystem.settings.whatsappNumber;
            document.getElementById('serviceHours').value = adminSystem.settings.serviceHours;
            
            // æ·»åŠ åˆå§‹æ—¥èªŒ
            adminSystem.addLog('ä¿¡æ¯', 'ç®¡ç†å¾Œå°å·²å•Ÿå‹•');
        });
    </script>
</body>
</html>