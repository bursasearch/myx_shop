<!DOCTYPE html>
<html>
<head>
    <title>AI评分测试验证</title>
    <meta charset="utf-8">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .good { color: green; font-weight: bold; }
        .warning { color: orange; font-weight: bold; }
        .bad { color: red; font-weight: bold; }
        table { border-collapse: collapse; width: 100%; margin: 20px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        tr:nth-child(even) { background-color: #f9f9f9; }
    </style>
</head>
<body>
    <h1>AI评分系统验证</h1>
    
    <div id="status">
        <h2>系统状态: <span id="statusText">加载中...</span></h2>
    </div>
    
    <div id="analysis">
        <h2>数据质量分析</h2>
        <div id="analysisResults"></div>
    </div>
    
    <div id="stocks">
        <h2>AI选股推荐</h2>
        <table id="stocksTable">
            <thead>
                <tr>
                    <th>排名</th>
                    <th>代码</th>
                    <th>名称</th>
                    <th>AI评分</th>
                    <th>潜力评分</th>
                    <th>推荐</th>
                    <th>价格</th>
                    <th>涨跌幅</th>
                </tr>
            </thead>
            <tbody id="stocksBody">
            </tbody>
        </table>
    </div>
    
    <script>
        async function loadData() {
            try {
                const response = await fetch('web/picks_latest.json');
                const data = await response.json();
                
                // 更新状态
                document.getElementById('statusText').textContent = '✅ 数据加载成功';
                document.getElementById('statusText').className = 'good';
                
                // 分析数据质量
                analyzeData(data);
                
                // 显示股票数据
                displayStocks(data);
                
            } catch (error) {
                document.getElementById('statusText').textContent = '❌ 数据加载失败: ' + error;
                document.getElementById('statusText').className = 'bad';
            }
        }
        
        function analyzeData(data) {
            const picks = data.picks || [];
            const analysisDiv = document.getElementById('analysisResults');
            
            if (picks.length === 0) {
                analysisDiv.innerHTML = '<p class="bad">❌ 没有股票数据</p>';
                return;
            }
            
            // 收集评分
            const scores = picks.map(p => p.score);
            const uniqueScores = [...new Set(scores)];
            const minScore = Math.min(...scores);
            const maxScore = Math.max(...scores);
            const avgScore = scores.reduce((a, b) => a + b) / scores.length;
            
            let analysisHTML = '<ul>';
            
            // 检查1: 评分数量
            analysisHTML += `<li>股票数量: ${picks.length} 只</li>`;
            
            // 检查2: 评分变化
            if (uniqueScores.length >= 8) {
                analysisHTML += `<li class="good">✅ 评分变化丰富: ${uniqueScores.length} 个不同评分</li>`;
            } else if (uniqueScores.length >= 5) {
                analysisHTML += `<li class="warning">⚠️ 评分变化一般: ${uniqueScores.length} 个不同评分</li>`;
            } else {
                analysisHTML += `<li class="bad">❌ 评分变化太少: ${uniqueScores.length} 个不同评分</li>`;
            }
            
            // 检查3: 评分范围
            analysisHTML += `<li>评分范围: ${minScore}-${maxScore} (平均: ${avgScore.toFixed(1)})</li>`;
            
            // 检查4: 是否有固定值65
            const hasFixed65 = scores.every(s => s === 65);
            if (hasFixed65) {
                analysisHTML += '<li class="bad">❌ 所有评分都是65 (虚拟数据)</li>';
            } else if (scores.includes(65)) {
                analysisHTML += '<li class="warning">⚠️ 部分评分是65</li>';
            } else {
                analysisHTML += '<li class="good">✅ 没有固定评分65</li>';
            }
            
            // 检查5: 评分分布
            analysisHTML += '<li>评分分布:';
            const scoreDist = {};
            scores.forEach(s => {
                scoreDist[s] = (scoreDist[s] || 0) + 1;
            });
            
            analysisHTML += '<ul>';
            Object.keys(scoreDist).sort((a,b) => b-a).forEach(score => {
                analysisHTML += `<li>${score}分: ${scoreDist[score]}只股票</li>`;
            });
            analysisHTML += '</ul></li>';
            
            analysisHTML += '</ul>';
            
            analysisDiv.innerHTML = analysisHTML;
        }
        
        function displayStocks(data) {
            const picks = data.picks || [];
            const tbody = document.getElementById('stocksBody');
            
            tbody.innerHTML = '';
            
            picks.forEach(pick => {
                const row = document.createElement('tr');
                
                // 根据评分设置颜色
                let scoreClass = 'warning';
                if (pick.score >= 85) scoreClass = 'good';
                else if (pick.score >= 75) scoreClass = '';
                else if (pick.score >= 65) scoreClass = 'warning';
                else scoreClass = 'bad';
                
                row.innerHTML = `
                    <td>${pick.rank}</td>
                    <td>${pick.code}</td>
                    <td>${pick.name}</td>
                    <td class="${scoreClass}">${pick.score}</td>
                    <td>${pick.potential_score}</td>
                    <td>${pick.recommendation}</td>
                    <td>RM${pick.current_price.toFixed(3)}</td>
                    <td>${pick.daily_change}%</td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        // 页面加载时获取数据
        document.addEventListener('DOMContentLoaded', loadData);
    </script>
</body>
</html>
